# Question and Answer 20180713

## 创建Host Aggregates

![How to create a host aggregates](https://access.redhat.com/solutions/2518581)

```
[root@packstacker carp(keystone_admin)]# nova aggregate-create test-agg AZ1
+----+----------+-------------------+-------+-------------------------+
| Id | Name     | Availability Zone | Hosts | Metadata                |
+----+----------+-------------------+-------+-------------------------+
| 7  | test-agg | AZ1               |       | 'availability_zone=AZ1' |
+----+----------+-------------------+-------+-------------------------+
```

```
nova aggregate-add-host test-agg computehoster
Host computehoster has been successfully added for aggregate 7 
+----+----------+-------------------+-----------------+-------------------------+
| Id | Name     | Availability Zone | Hosts           | Metadata                |
+----+----------+-------------------+-----------------+-------------------------+
| 7  | test-agg | AZ1               | 'computehoster' | 'availability_zone=AZ1' |
+----+----------+-------------------+-----------------+-------------------------+
```

## 创建及管理Host Aggregates

[Create and manage host aggregates](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux_OpenStack_Platform/5/html/Administration_User_Guide/dashboard_manage_host_aggregates.html)

## Host Aggregates使用的例子
[Driving in the Fast Lane – CPU Pinning and NUMA Topology Awareness in OpenStack Compute](https://redhatstackblog.redhat.com/2015/05/05/cpu-pinning-and-numa-topology-awareness-in-openstack-compute/)

## 关于Host Aggregates的博客
[Availability Zones and Host Aggregates in OpenStack Compute (Nova)](https://blog.russellbryant.net/2013/05/21/availability-zones-and-host-aggregates-in-openstack-compute-nova/)

## 关于OpenStack Availability Zone写得比较明白的一篇Blog
[The first and final words on OpenStack availability zones](https://www.mirantis.com/blog/the-first-and-final-word-on-openstack-availability-zones/)

## 命令范例

```
$ nova aggregate-create Host_Aggregation1
$ nova aggregate-set-metadata Host_Aggregation1 availability_zone=Availability_Zone1
$ nova aggregate-add-host Host_Aggregation1 overcloud-compute-0

$ nova aggregate-create Host_Aggregation2
$ nova aggregate-set-metadata Host_Aggregation2 availability_zone=Availability_Zone1
$ nova aggregate-add-host Host_Aggregation2 overcloud-compute-0

$ nova aggregate-create Host_Aggregation3
$ nova aggregate-set-metadata Host_Aggregation3 availability_zone=Availability_Zone2
$ nova aggregate-add-host Host_Aggregation3 overcloud-compute-0

$ nova flavor-create --is-public true flavor1 100 2048 20 2
$ nova flavor-key flavor1 set state=beijing
$ nova aggregate-set-metadata Host_Aggregation1 state=beijing

$ nova boot --flavor flavor1 --image 64d985ba-2cfa-434d-b789-06eac141c260 --availability-zone Availability_Zone1 testinstance
$ nova aggregate-remove-host Host_Aggregation1 overcloud-compute-0 
```
