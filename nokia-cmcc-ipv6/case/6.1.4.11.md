### 6.1.4.11

测试步骤
> 1. 配置或检查各组件之间通信地址为IPv6（数据库访问、消息队列访问等），有预期结果1
> 2. 配置存储面地址为IPv6，查看计算节点或控制节点与存储平面的互通信，有预期结果2

测试预期结果
> 1. 预期结果1：成功配置或检查出各组件之间通信地址为IPv6（数据库访问、消息队列访问等）
> 2. 预期结果2：成功配置存储面地址为IPv6，查看计算节点或控制节点与存储平面的互通信正常

实际检查结果
1. 数据库: yes 
   ```
   ss -antp | grep LISTEN | grep mysql
   ```
   消息队列: yes
   ```  
   ss -antp | grep LISTEN | grep beam
   ```
2. 存储面地址<br>
   存储面地址所在网段
   ```
   cat ~/templates/network-environment.yaml | grep '  StorageNetCidr'
   ```
   登录控制节点和计算节点获得这个网段的 ip 地址，从计算节点 ping 控制节点这个网段的 ip 地址


**注意**：overcloud swift proxy 配置文件有问题，需要提前调整配置文件内容<br>


   修改控制节点 /etc/swift/proxy-server.conf 并重启服务<br>
   ```
   sudo sed -i -e 's,^pipeline = catch_errors.*$,pipeline = catch_errors healthcheck proxy-logging cache ratelimit bulk tempurl formpost authtoken keystone staticweb versioned_writes proxy-logging proxy-server,' /etc/swift/proxy-server.conf
   sudo systemctl restart openstack-swift-proxy      
   ```

准备环境
```
cd /home/stack
source /home/stack/overcloudrc
openstack keypair create --public-key ~/.ssh/id_rsa.pub stack
openstack flavor create m1.small --id auto --ram 2048 --disk 20 --vcpu 1
neutron net-create test-net-1
neutron subnet-create \
  --name test-net-1-subnet  \
  --no-gateway \
  --enable-dhcp=True \
  test-net-1 172.16.200.0/24
openstack volume create --size 1 --image $(openstack image show cirros-0.3.4 --column id --format value) vol1
```

创建实例
```
openstack server create \
  --image $(openstack image show cirros-0.3.4 --column id --format value) \
  --key-name stack \
  --flavor m1.small \
  --nic net-id=$(openstack network show test-net-1 --column id --format value) \
  --block-device-mapping vda=$(openstack volume show vol1 --column id --format value)::1:1 \
  test-instance-01
```

检查实例已经 attach 卷
```
openstack volume list
+--------------------------------------+--------------+--------+------+-------------------------------------------+
| ID                                   | Display Name | Status | Size | Attached to                               |
+--------------------------------------+--------------+--------+------+-------------------------------------------+
| 5db94ea5-e533-4839-a208-b8ac3c32eb9a | vol1         | in-use |    1 | Attached to test-instance-01 on /dev/vda  |
+--------------------------------------+--------------+--------+------+-------------------------------------------+ 
```

      
控制节点 /etc/swift/proxy-server.conf 文件修改的地方
```
[root@overcloud-controller-0 ~]# diff -urN /etc/swift/proxy-server.conf.sav /etc/swift/proxy-server.conf 
--- /etc/swift/proxy-server.conf.sav    2018-07-30 10:57:28.268249296 +0800
+++ /etc/swift/proxy-server.conf        2018-07-30 10:58:00.309269334 +0800
@@ -12,7 +12,8 @@
 log_address = /dev/log
 
 [pipeline:main]
-pipeline = catch_errors healthcheck proxy-logging cache ratelimit bulk tempurl formpost authtoken keystone staticweb versioned_writes ceilometer proxy-logging proxy-server
+pipeline = catch_errors healthcheck proxy-logging cache ratelimit bulk tempurl formpost authtoken keystone staticweb versioned_writes proxy-logging proxy-server 

[root@overcloud-controller-0 ~]# systemctl restart openstack-swift-proxy
```



