# 环境3

![Matterhorn](./images/Matterhorn.jpeg)

## 硬件类型
IBM

## OSP版本
OSP10

## undercloud
192.168.246.151

## 环境问题

|节点|IPMI|问题描述|实际情况|
|:--------------------:|:-------:|:-------:|:--------|
|overcloud-controller-2|192.168.47.84|无法IPMI登陆|Login failed. Verify that your username and password are correct.|
|overcloud-sriovcompute-1|192.168.47.85|无法IPMI登陆|Login failed. Verify that your username and password are correct.|

### 控制节点服务问题

|服务|问题描述|
|:--:|:------:|
|gelara|无法启动Waiting on node <overcloud-controller-2> to report database status before Master instances can start

```
[root@overcloud-controller-0 mysql]# cat grastate.dat 
# GALERA saved state
version: 2.1
uuid:    615689d7-4b5d-11e7-9da8-43c66376b9d0
seqno:   128048352
cert_index:

[root@overcloud-controller-1 mysql]# cat grastate.dat 
# GALERA saved state
version: 2.1
uuid:    615689d7-4b5d-11e7-9da8-43c66376b9d0
seqno:   128048352
cert_index:
```

手工bootstrap
https://access.redhat.com/articles/2332651

```
[root@overcloud-controller-0 ~]# pcs resource show galera-master 
 Master: galera-master
  Meta Attrs: ordered=true master-max=3 is-managed=false 
  Resource: galera (class=ocf provider=heartbeat type=galera)
   Attributes: additional_parameters=--open-files-limit=16384 enable_creation=true wsrep_cluster_address=gcomm://overcloud-controller-0,overcloud-controller-1,overcloud-controller-2
   Operations: start interval=0s timeout=120 (galera-start-interval-0s)
               stop interval=0s timeout=120 (galera-stop-interval-0s)
               monitor interval=20 timeout=30 (galera-monitor-interval-20)
               monitor interval=10 role=Master timeout=30 (galera-monitor-interval-10)
               monitor interval=30 role=Slave timeout=30 (galera-monitor-interval-30)
               demote interval=0s timeout=120 (galera-demote-interval-0s)
               promote interval=0s on-fail=block timeout=300s (galera-promote-interval-0s)

crm_attribute -N overcloud-controller-0 -l reboot --name galera-last-committed -Q
crm_attribute -N overcloud-controller-0 -l reboot --name galera-bootstrap -v true
crm_attribute -N overcloud-controller-0 -l reboot --name master-galera -v 100
crm_resource --force-promote -r galera -V
pcs resource cleanup galera
pcs resource enable galera
pcs resource manage galera
```

### overcloud 恢复情况
控制节点已恢复，overcloud api已可访问，计算节点服务异常

